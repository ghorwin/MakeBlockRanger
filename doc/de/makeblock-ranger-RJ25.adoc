:imagesdir: ../images

[[chap:rj25]]
# RJ25 Ports und externe Zubehörkomponenten (Abstandssensor und Linienfolgesensor)

## Allgemeines zu RJ25

Die Steckerports am Auriga-Board sind RJ25 (6P6C) Stecker, siehe https://de.wikipedia.org/wiki/RJ-Steckverbindung[Wikipedia RJ-Steckverbindung], wie sie auch für den Anschluss von Modems und Faxgeräten verwendet werden/wurden. Die Belegung der Pins ist im   
link:../downloads/MakeBlock/MeAuriga_Schaltplan.pdf[Schaltplan] zu sehen, wie hier im Auszug für den Port 9:

.RJ25 Belegung an Port 9
image::RJ25_schaltplan_auszug.png[pdfwidth=4cm]

.RJ25 Stecker
image::RJ25_pin_Belegung.png[pdfwidth=4cm]


Jeder dieser Stecker ist mit VCC und GND verbunden, sowie alle parallel an SDA und SCL (für die Kommunikation über das I2C Protokoll).
Die mit S1 und S2 (Slot 1 und Slot 2) bezeichneten Leitungen sind je Port mit unterschiedlichen Pins am Arduino verbunden. Je nach Fähigkeiten dieser Pins sind die Ports unterschiedlich eingefärbt. Eine Gesamtübersicht über die Ports, deren Belegung und Stromversorgung ist im [Ersten Teil zum Auriga/mBot Ranger](auriga-first-steps-DE) gegeben.

[NOTE]
====
Die Ports sind unterschiedlich abgesichert und bieten unterschiedliche Spannungen. Außerdem sind unterschiedliche Pins angeklemmt, was verschiedene Möglichkeiten zum Anschluss externer Hardware bietet:

.Aurigaplatine mit unterschiedlichen RJ25 Ports
image::auriga_schaubild.jpg[width=500, pdfwidth=12cm]

.Farbkodierung der Anschlüsse (Details dazu im Kapitel zu den RJ25 Ports)
image::farbcodierung_auriga.jpg[width=150, pdfwidth=4cm]

- PORT1 - PORT4 unterstützen einen kontinuierlichen 3,5A-Ausgang (max. 5A)
- PORT1 - PORT4 haben einen Kurzschluss- und Überstromschutz für 3,5A

- PORT5 - PORT10 unterstützen kontinuierlich 5V DC und 4A Ausgang (max. 3A)
- PORT5 - PORT10 haben einen Kurzschluss- und Überstromschutz für 3A
====

An diese Ports kann man nun diverse Zubehörbauteile anstecken (die aber häufig nicht ganz billig sind).

Man kann auch einfach RJ25 Stecker kaufen und über die einzelnen Kabel beliebige elektronische Bauteile anklemmen/anlöten:

.RJ25 Adapter Kabel
image::RJ25-adapter-Kabel.jpg[pdfwidth=4cm]


### Zubehör

MakeBlock bietet selbst zahlreiches Zubehör mit dem RJ25 Stecker an:

.RJ25 Zubehör
image::auriga-rj25-addons.png[pdfwidth=16cm]


## Ultraschall-Entfernungsmessung

Zur Entfernungsmessung liegt im mBot Ranger Bausatz ein Ultraschallsensor dabei. Diesen kann man einfach an einen I2C-Port anstecken (Ports 6-10).

.Ultraschall Entfernungssensor
image::auriga_ultrasonicdistance.png[pdfwidth=4cm]


Wie der Sensor intern funktioniert, ist auf der Seite https://funduino.de/nr-10-entfernung-messen[Fundino Ultraschallsensor]  beschrieben.

In Kürze: Der Sensor emittiert eine Ultraschallwelle (wie die Fledermaus) und wenn diese auf ein Objekt trifft, wird die Welle zurückgeworfen. Die Schallgeschwindigkeit in Luft ist ungefähr 340 m/s (oder 34 cm/ms bzw. 0.034 cm/µs). Der Sensor misst die Zeit zwischen Senden und Empfangen der Schallwelle und kann daraus die Entfernung berechnen.

Falls z.B. die Schallwelle durch ein Objekt zurückgeworfen wird, und seit dem Senden 1000 µs vergangen sind, dann hat die Schallwelle ZUM OBJEKT nur 500 µs benötigt. Das ergibt dann die Entfernung von 500 µs * 0.034 cm/µs = 17 cm.

Der Sensor wird mittels der Klasse `MeUltrasonicSensor` angesteuert, welche folgende Funktionen bietet:

```c++
#include "MeAuriga.h"

// Der Utrasonic-Sensor ist an Steckplatz 6 eingesteckt
MeUltrasonicSensor ultraSensor(PORT_6);

unsigned long lastSamlingMillis;

void setup() {
  lastSamlingMillis = millis();
  Serial.begin(115200);
}

void loop() {
  if (millis() - lastSamlingMillis > 100) {
    Serial.print("Distance,");
    Serial.println(min(50, ultraSensor.distanceCm() ) );
    lastSamlingMillis = millis();
  }

  // ... anderes Zeugs machen...

}
```

Zwischen Senden und Empfangen benötigt der Sensor eine minimale Wartezeit von 100 ms.
Wenn man den Sensor also abfragt, und kein `delay()` verwenden möchte (bspw. um nebenbei noch andere
Sensoren abzufragen), dann muss man das Timing manuell implementieren.

TODO :

- Async-Messung
- Einfallswinkel für Schallpegel
- Genauigkeit ???



## Linienverfolgungssensor

<center>
<img src="../../images/auriga/auriga_linefollower.png" alt="Linienverfolgungs-Sensor"/>
</center>

Weiter zu [Teil 7](../auriga-park-assistent-DE.html).
